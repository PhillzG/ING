<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prognoza Ceny Nieruchomości</title>
    <script>
        let districtData = {};

        async function fetchDistricts() {
            let response = await fetch("/get_districts");
            districtData = await response.json();
        }

        function updateDistricts() {
            let city = document.getElementById("city").value;
            let districtSelect = document.getElementById("district");
            districtSelect.innerHTML = "";

            if (districtData[city]) {
                districtData[city].forEach(district => {
                    let option = document.createElement("option");
                    option.value = district;
                    option.textContent = district;
                    districtSelect.appendChild(option);
                });
            }
        }

        async function predictPrice() {
            let data = {
                "City": document.getElementById("city").value,
                "District": document.getElementById("district").value,
                "Area_m2": parseFloat(document.getElementById("area").value),
                "Rooms": parseInt(document.getElementById("rooms").value),
                "Year_Built": parseInt(document.getElementById("year_built").value),
                "Floor": parseInt(document.getElementById("floor").value),
                "Condition": document.getElementById("condition").value,
                "Interest_Rate": parseFloat(document.getElementById("interest_rate").value),
                "Inflation": parseFloat(document.getElementById("inflation").value),
                "Market_Trend": document.getElementById("market_trend").value,
                "Energy_Efficiency": document.getElementById("energy_efficiency").value,
                "Green_Access": parseInt(document.getElementById("green_access").value),
                "Carbon_Footprint": document.getElementById("carbon_footprint").value
            };

            let response = await fetch("/predict", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });

            let result = await response.json();
            document.getElementById("result").innerHTML = 
                `<p><b>Cena Regresji Liniowej:</b> ${result["Cena Regresji Liniowej"]} PLN</p>
                 <p><b>Cena XGBoost:</b> ${result["Cena XGBoost"]} PLN</p>`;
        }

        window.onload = async () => {
            await fetchDistricts();
            updateDistricts();
        };
    </script>
</head>
<body>
    <h1>Prognoza Ceny Nieruchomości</h1>

    <label for="city">Miasto:</label>
    <select id="city" onchange="updateDistricts()">
        {% for city in cities %}
        <option value="{{ city }}">{{ city }}</option>
        {% endfor %}
    </select>

    <label for="district">Dzielnica:</label>
    <select id="district"></select>

    <label for="area">Metraż (m²):</label>
    <input type="number" id="area">

    <label for="rooms">Liczba pokoi:</label>
    <input type="number" id="rooms">

    <label for="year_built">Rok budowy:</label>
    <input type="number" id="year_built">

    <label for="floor">Piętro:</label>
    <input type="number" id="floor">

    <label for="condition">Stan mieszkania:</label>
    <select id="condition">
        <option value="Nowe">Nowe</option>
        <option value="Po remoncie">Po remoncie</option>
        <option value="Do remontu">Do remontu</option>
    </select>

    <label for="interest_rate">Stopa procentowa:</label>
    <input type="number" id="interest_rate" step="0.1">

    <label for="inflation">Inflacja:</label>
    <input type="number" id="inflation" step="0.1">

    <label for="market_trend">Trend rynkowy:</label>
    <select id="market_trend">
        <option value="Wzrostowy">Wzrostowy</option>
        <option value="Stabilny">Stabilny</option>
        <option value="Spadkowy">Spadkowy</option>
    </select>

    <label for="energy_efficiency">Efektywność energetyczna:</label>
    <select id="energy_efficiency">
        <option value="A">A</option>
        <option value="B">B</option>
        <option value="C">C</option>
        <option value="D">D</option>
    </select>

    <label for="green_access">Dostęp do terenów zielonych (1-10):</label>
    <input type="number" id="green_access">

    <label for="carbon_footprint">Ślad węglowy:</label>
    <select id="carbon_footprint">
        <option value="Niski">Niski</option>
        <option value="Średni">Średni</option>
        <option value="Wysoki">Wysoki</option>
    </select>

    <button onclick="predictPrice()">Oblicz cenę</button>

    <h2>Wynik:</h2>
    <div id="result"></div>
</body>
</html>
